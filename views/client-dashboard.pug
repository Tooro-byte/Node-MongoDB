doctype html
html(lang='en')
  head
    meta(charset='UTF-8')
    meta(name='viewport', content='width=device-width, initial-scale=1.0')
    title Kings Collection Customer Dashboard
    link(rel='stylesheet', href='/Styles/client-dashboard.css')
    link(rel='preconnect', href='https://fonts.googleapis.com')
    link(rel='preconnect', href='https://fonts.gstatic.com', crossorigin='')
    link(href='https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap', rel='stylesheet')
    link(rel='stylesheet', href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css')
  body
    //- Header
    header.header
      .container
        .header-content
          .logo
            i.fas.fa-crown
            span Kings Collection
          //- Main Navigation Tabs
          nav.main-nav
            a.nav-tab.active(href='/client-page', data-section='dashboard')
              i.fas.fa-home
              span Dashboard
            a.nav-tab(href='/orders', data-section='orders')
              i.fas.fa-box
              span My Orders
              span.badge #{orderCount || 0}
            a.nav-tab(href='/products', data-section='products')
              i.fas.fa-tags
              span Products
            a.nav-tab(href='/api/cart', data-section='cart')
              i.fas.fa-shopping-cart
              span Cart
              span.badge #{cart ? cart.totalProducts : 0}
            a.nav-tab(href='/messages', data-section='messages')
              i.fas.fa-envelope
              span Messages
              span.badge.new #{messageCount || 0}
            a.nav-tab(href='/payment-methods', data-section='payment-methods')
              i.fas.fa-credit-card
              span Payment
          .header-actions
            .search-box
              i.fas.fa-search
              input(type='text', placeholder='Search products...')
            .notifications
              button.notification-btn
                i.fas.fa-bell
                span.notification-count #{notificationCount || 0}
            .user-menu
              .user-avatar
                img(src=user.photo || 'https://images.pexels.com/photos/220453/pexels-photo-220453.jpeg?auto=compress&cs=tinysrgb&w=100', alt='User')
              .user-info
                span.user-name #{user.name || 'Guest'}
                span.user-status #{user.role === 'client' ? 'Premium Member' : user.role}
              .dropdown-menu
                a(href='/account', data-section='account')
                  i.fas.fa-user
                  | Profile Settings
                a(href='/support', data-section='support')
                  i.fas.fa-life-ring
                  | Help & Support
                a(href='/logout')
                  i.fas.fa-sign-out-alt
                  | Logout
    //- Main Content
    main.main-content
      .container
        //- Welcome Section with Digital Clock
        section.welcome-section
          .welcome-card
            .welcome-text
              h1
                | Welcome back, 
                span.highlight #{user.name || 'Guest'}!
              p Ready to discover amazing deals and new arrivals?
              .digital-clock
                .clock-display
                  span#current-time 12:00:00
                  span#current-date Monday, January 1, 2025
            .account-summary
              .summary-item
                .summary-icon
                  i.fas.fa-box
                .summary-content
                  .summary-number #{orderCount || 0}
                  .summary-label Total Orders
              .summary-item
                .summary-icon
                  i.fas.fa-dollar-sign
                .summary-content
                  .summary-number $#{totalSpent || 0}
                  .summary-label Total Spent
              .summary-item
                .summary-icon
                  i.fas.fa-calendar
                .summary-content
                  .summary-number #{lastOrderDate || 'N/A'}
                  .summary-label Last Order
              .summary-item
                .summary-icon
                  i.fas.fa-star
                .summary-content
                  .summary-number #{loyaltyPoints || 0}
                  .summary-label Loyalty Points
        //- Dashboard Grid
        .dashboard-grid
          //- Enhanced Sidebar Navigation
          aside.sidebar
            nav.sidebar-nav
              .nav-section
                h4 Main
                a.nav-item.active(href='/client-page', data-section='dashboard')
                  i.fas.fa-home
                  span Dashboard Home
                a.nav-item(href='/orders', data-section='orders')
                  i.fas.fa-box
                  span My Orders
                  span.count #{orderCount || 0}
                a.nav-item(href='/products', data-section='products')
                  i.fas.fa-tags
                  span Products
              .nav-section
                h4 Account
                a.nav-item(href='/account', data-section='account')
                  i.fas.fa-user-cog
                  span Account Details
                a.nav-item(href='/addresses', data-section='addresses')
                  i.fas.fa-map-marker-alt
                  span Addresses
                a.nav-item(href='/payment-methods', data-section='payment-methods')
                  i.fas.fa-credit-card
                  span Payment Methods
              .nav-section
                h4 Shopping
                a.nav-item(href='/wishlist', data-section='wishlist')
                  i.fas.fa-heart
                  span Wishlist
                  span.count #{wishlistCount || 0}
                a.nav-item(href='/cart', data-section='cart')
                  i.fas.fa-shopping-cart
                  span Cart
                  span.count #{cart ? cart.totalProducts : 0}
                a.nav-item(href='/reviews', data-section='reviews')
                  i.fas.fa-star
                  span Reviews
              .nav-section
                h4 Communication
                a.nav-item(href='/messages', data-section='messages')
                  i.fas.fa-envelope
                  span Messages
                  span.count.new #{messageCount || 0}
                a.nav-item(href='/notifications', data-section='notifications')
                  i.fas.fa-bell
                  span Notifications
                  span.count #{notificationCount || 0}
              .nav-section
                h4 Services
                a.nav-item(href='/loyalty', data-section='loyalty')
                  i.fas.fa-gift
                  span Loyalty & Rewards
                a.nav-item(href='/subscriptions', data-section='subscriptions')
                  i.fas.fa-sync-alt
                  span Subscriptions
                a.nav-item(href='/referrals', data-section='referrals')
                  i.fas.fa-users
                  span Referrals
              .nav-section
                h4 Support
                a.nav-item(href='/settings', data-section='settings')
                  i.fas.fa-cog
                  span Settings
                a.nav-item(href='/support', data-section='support')
                  i.fas.fa-life-ring
                  span Support & Help
                a.nav-item.logout(href='/logout')
                  i.fas.fa-sign-out-alt
                  span Logout
          //- Main Dashboard Content
          .dashboard-content
            //- Dashboard Home Section
            section#dashboard.content-section.active
              .section-header
                h2 Dashboard Overview
                p Your personalized shopping experience at a glance
              //- Quick Stats
              .stats-grid
                .stat-card
                  .stat-icon.orders
                    i.fas.fa-box
                  .stat-content
                    .stat-number #{orderCount || 0}
                    .stat-label Orders This Year
                    .stat-trend.positive
                      i.fas.fa-arrow-up
                      span +15% from last year
                .stat-card
                  .stat-icon.wishlist
                    i.fas.fa-heart
                  .stat-content
                    .stat-number #{wishlistCount || 0}
                    .stat-label Wishlist Items
                    .stat-trend.neutral
                      span #{wishlistOnSale || 0} items on sale
                .stat-card
                  .stat-icon.loyalty
                    i.fas.fa-star
                  .stat-content
                    .stat-number #{loyaltyPoints || 0}
                    .stat-label Loyalty Points
                    .stat-trend.positive
                      span Ready to redeem
                .stat-card
                  .stat-icon.savings
                    i.fas.fa-piggy-bank
                  .stat-content
                    .stat-number $#{totalSaved || 0}
                    .stat-label Total Saved
                    .stat-trend.positive
                      span Through deals & discounts
              //- Recent Activity & Recommendations
              .dashboard-widgets
                .widget.recent-orders
                  .widget-header
                    h3 Recent Orders
                    a.view-all(href='/orders', data-section='orders') View All
                  .order-list
                    if recentOrders && recentOrders.length
                      each order in recentOrders
                        .order-item
                          .order-image
                            img(src=order.image || 'https://images.pexels.com/photos/1598505/pexels-photo-1598505.jpeg?auto=compress&cs=tinysrgb&w=100', alt='Order')
                          .order-info
                            h4 #{order.title || 'Product'}
                            p Order #{order.orderId || 'N/A'}
                            span.order-date #{order.orderDate || 'N/A'}
                          .order-status(class=order.status ? order.status.toLowerCase() : 'pending')
                            i.fas(class=order.status === 'Shipped' ? 'fa-truck' : order.status === 'Delivered' ? 'fa-check-circle' : 'fa-hourglass')
                            span #{order.status || 'Pending'}
                    else
                      p No recent orders found.
                .widget.recommendations
                  .widget-header
                    h3 Recommended for You
                    a.view-all(href='/products') Browse More
                  .product-grid
                    if recommendedProducts && recommendedProducts.length
                      each product in recommendedProducts
                        .product-card
                          .product-image
                            img(src=product.images[0] || 'https://images.pexels.com/photos/1598508/pexels-photo-1598508.jpeg?auto=compress&cs=tinysrgb&w=300', alt=product.title)
                            if product.isNew
                              .product-badge New
                          .product-info
                            h4 #{product.title}
                            .product-rating
                              .stars
                                - var rating = product.averageRating || 4.8
                                - var fullStars = Math.floor(rating)
                                - var halfStar = rating % 1 >= 0.5
                                - for (var i = 0; i < fullStars; i++)
                                  i.fas.fa-star
                                if halfStar
                                  i.fas.fa-star-half-alt
                                - for (var i = fullStars + (halfStar ? 1 : 0); i < 5; i++)
                                  i.far.fa-star
                              span (#{rating})
                            .product-price
                              span.current $#{product.price.toFixed(2)}
                              if product.originalPrice
                                span.original $#{product.originalPrice.toFixed(2)}
                            button.btn.btn-primary(data-product-id=product._id) Add to Cart
                    else
                      p No recommendations available.
            //- Orders Section
            section#orders.content-section
              .section-header
                h2 Order History
                p Track and manage all your orders
              .orders-container
                .order-filters
                  .filter-group
                    select.filter-select
                      option(value='all') All Orders
                      option(value='processing') Processing
                      option(value='shipped') Shipped
                      option(value='delivered') Delivered
                      option(value='cancelled') Cancelled
                    input.search-input(type='text', placeholder='Search orders...')
                  button.btn.btn-outline.download-orders
                    i.fas.fa-download
                    | Export Orders
                .orders-list
                  if orders && orders.length
                    each order in orders
                      .order-card
                        .order-header
                          .order-info
                            h4 Order #{order.orderId || 'N/A'}
                            p #{order.orderDate || 'N/A'}
                          .order-status(class=order.status ? order.status.toLowerCase() : 'pending')
                            i.fas(class=order.status === 'Shipped' ? 'fa-truck' : order.status === 'Delivered' ? 'fa-check-circle' : 'fa-hourglass')
                            span #{order.status || 'Pending'}
                          .order-total $#{order.totalPrice ? order.totalPrice.toFixed(2) : '0.00'}
                        .order-items
                          each item in order.items
                            .order-item
                              img(src=item.image || 'https://images.pexels.com/photos/1598505/pexels-photo-1598505.jpeg?auto=compress&cs=tinysrgb&w=100', alt='Product')
                              .item-details
                                h5 #{item.title}
                                p Size: #{item.size || 'N/A'}, Color: #{item.color || 'N/A'} | Qty: #{item.quantity}
                                span.item-price $#{item.price.toFixed(2)}
                        .order-actions
                          button.btn.btn-outline
                            i.fas.fa-truck
                            | Track Order
                          button.btn.btn-outline
                            i.fas.fa-receipt
                            | View Invoice
                          button.btn.btn-outline
                            i.fas.fa-redo
                            | Reorder
                  else
                    p No orders found.
            //- Messages Section
            section#messages.content-section
              .section-header
                h2 Messages
                p Your communication hub
              .messages-container
                .message-filters
                  button.filter-btn.active(data-filter='all') All Messages
                  button.filter-btn(data-filter='unread') Unread (#{unreadMessageCount || 0})
                  button.filter-btn(data-filter='orders') Order Updates
                  button.filter-btn(data-filter='promotions') Promotions
                .messages-list
                  if messages && messages.length
                    each message in messages
                      .message-item(class=message.isUnread ? 'unread' : '')
                        .message-avatar
                          i.fas(class=message.type === 'order' ? 'fa-truck' : 'fa-gift')
                        .message-content
                          .message-header
                            h4 #{message.title}
                            span.message-time #{message.timeAgo || 'Recent'}
                          p #{message.content}
                          .message-actions
                            if message.type === 'order'
                              button.btn.btn-text Track Order
                            if message.isUnread
                              button.btn.btn-text Mark as Read
                            if message.type === 'promotion'
                              button.btn.btn-text Shop Now
                  else
                    p No messages available.
            //- Cart Section
            section#cart.content-section
              .section-header
                h2 Shopping Cart
                p Review your items before checkout
              .cart-container
                .cart-items
                  if cart && cart.products && cart.products.length
                    each item in cart.products
                      .cart-item
                        .item-checkbox
                          input(type='checkbox', id=`item${item.productId}`, checked='')
                          label(for=`item${item.productId}`)
                        .item-image
                          img(src=item.image || 'https://images.pexels.com/photos/1598505/pexels-photo-1598505.jpeg?auto=compress&cs=tinysrgb&w=150', alt='Product')
                        .item-details
                          h4 #{item.title}
                          p Size: #{item.size || 'N/A'}, Color: #{item.color || 'N/A'}
                          .item-features
                            span.feature-tag Premium Quality
                            span.feature-tag Free Shipping
                          .item-price $#{item.price.toFixed(2)}
                        .item-quantity
                          button.qty-btn.minus(data-product-id=item.productId)
                            i.fas.fa-minus
                          input.qty-input(type='number', value=item.quantity, min='1', data-product-id=item.productId)
                          button.qty-btn.plus(data-product-id=item.productId)
                            i.fas.fa-plus
                        .item-total $#{ (item.price * item.quantity).toFixed(2) }
                        .item-actions
                          button.action-btn.wishlist(data-product-id=item.productId)
                            i.fas.fa-heart
                          button.action-btn.remove(data-product-id=item.productId)
                            i.fas.fa-trash
                  else
                    p Your cart is empty.
                .cart-sidebar
                  .cart-summary
                    h3 Order Summary
                    .summary-row
                      span Subtotal (#{cart ? cart.totalProducts : 0} items):
                      span $#{cart ? cart.totalCartPrice.toFixed(2) : '0.00'}
                    .summary-row
                      span Shipping:
                      span.free Free
                    .summary-row
                      span Tax:
                      span $#{cart ? (cart.totalCartPrice * 0.08).toFixed(2) : '0.00'}
                    .summary-row.discount
                      span Loyalty Discount (10%):
                      span -$#{cart ? (cart.totalCartPrice * 0.1).toFixed(2) : '0.00'}
                    .summary-row.total
                      span Total:
                      span $#{cart ? (cart.totalCartPrice + (cart.totalCartPrice * 0.08) - (cart.totalCartPrice * 0.1)).toFixed(2) : '0.00'}
                    button.btn.btn-primary.checkout-btn
                      i.fas.fa-lock
                      | Secure Checkout
                  .promo-code
                    h4 Promo Code
                    .promo-input
                      input(type='text', placeholder='Enter code')
                      button.btn.btn-outline Apply
    script(src='/vanilla-js/client-dashboard.js')