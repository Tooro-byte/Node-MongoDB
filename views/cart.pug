doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport" content="width=device-width, initial-scale=1.0")
    title Shopping Cart
    link(rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css")
    style.
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }
      .container {
        max-width: 1400px;
        margin: 0 auto;
      }
      .user-profile {
        margin-bottom: 30px;
        animation: slideDown 0.5s ease-out;
      }
      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .profile-card {
        background: white;
        border-radius: 20px;
        padding: 25px;
        display: flex;
        align-items: center;
        gap: 20px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }
      .profile-card:hover {
        transform: translateY(-5px);
      }
      .profile-image {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        object-fit: cover;
        border: 4px solid #667eea;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      }
      .profile-info {
        flex: 1;
      }
      .user-name {
        font-size: 24px;
        color: #2d3748;
        margin-bottom: 5px;
        font-weight: 600;
      }
      .user-email {
        color: #718096;
        font-size: 14px;
        margin-bottom: 10px;
      }
      .cart-badge {
        display: inline-block;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 600;
      }
      .cart-section {
        background: white;
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        animation: fadeIn 0.6s ease-out;
      }
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      .cart-title {
        font-size: 32px;
        color: #2d3748;
        margin-bottom: 30px;
        text-align: center;
        font-weight: 700;
      }
      .cart-title i {
        color: #667eea;
        margin-right: 10px;
      }
      .table-container {
        overflow-x: auto;
        margin-bottom: 30px;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
      }
      .cart-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        background: white;
      }
      .cart-table thead {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }
      .cart-table th {
        padding: 18px;
        text-align: left;
        font-weight: 600;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      .cart-table th:first-child {
        border-top-left-radius: 12px;
      }
      .cart-table th:last-child {
        border-top-right-radius: 12px;
      }
      .cart-table tbody tr {
        border-bottom: 1px solid #e2e8f0;
        transition: background-color 0.2s ease;
      }
      .cart-table tbody tr:hover {
        background-color: #f7fafc;
      }
      .cart-table td {
        padding: 20px 18px;
        vertical-align: middle;
      }
      .product-image {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .product-title {
        font-weight: 600;
        color: #2d3748;
        font-size: 16px;
      }
      .product-price {
        font-weight: 600;
        color: #667eea;
        font-size: 18px;
      }
      .quantity-cell {
        text-align: center;
      }
      .quantity-controls {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        background: #f7fafc;
        padding: 8px 12px;
        border-radius: 25px;
        border: 2px solid #e2e8f0;
      }
      .qty-btn {
        width: 32px;
        height: 32px;
        border: none;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        font-size: 14px;
      }
      .qty-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      }
      .qty-btn:active {
        transform: scale(0.95);
      }
      .quantity-display {
        font-weight: 700;
        color: #2d3748;
        font-size: 16px;
        min-width: 30px;
        text-align: center;
      }
      .subtotal {
        font-weight: 700;
        color: #2d3748;
        font-size: 18px;
      }
      .action-cell {
        text-align: center;
      }
      .delete-btn {
        background: #fc8181;
        border: none;
        color: white;
        padding: 10px 15px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 16px;
      }
      .delete-btn:hover {
        background: #f56565;
        transform: scale(1.05);
      }
      .grand-total-container {
        display: flex;
        justify-content: flex-end;
        margin-top: 30px;
      }
      .summary-card {
        background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
        border-radius: 16px;
        padding: 30px;
        min-width: 400px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
        border: 2px solid #e2e8f0;
      }
      .summary-title {
        font-size: 22px;
        color: #2d3748;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 700;
      }
      .summary-title i {
        color: #667eea;
      }
      .summary-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 15px;
        font-size: 16px;
      }
      .summary-label {
        color: #4a5568;
        font-weight: 500;
      }
      .summary-value {
        color: #2d3748;
        font-weight: 600;
      }
      .divider {
        border: none;
        border-top: 2px solid #cbd5e0;
        margin: 20px 0;
      }
      .total-row {
        font-size: 20px;
        margin-top: 15px;
      }
      .grand-total {
        color: #667eea;
        font-size: 24px;
        font-weight: 800;
      }
      .action-buttons {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-top: 25px;
      }
      .checkout-btn, .continue-shopping-btn, .clear-cart-btn {
        padding: 15px 25px;
        border: none;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        text-decoration: none;
      }
      .checkout-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
      }
      .checkout-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
      }
      .continue-shopping-btn {
        background: #48bb78;
        color: white;
      }
      .continue-shopping-btn:hover {
        background: #38a169;
        transform: translateY(-3px);
      }
      .clear-cart-btn {
        background: #fc8181;
        color: white;
      }
      .clear-cart-btn:hover {
        background: #f56565;
        transform: translateY(-3px);
      }
      .empty-cart {
        text-align: center;
        padding: 80px 20px;
      }
      .empty-icon {
        font-size: 120px;
        color: #cbd5e0;
        margin-bottom: 20px;
      }
      .empty-cart h2 {
        font-size: 32px;
        color: #2d3748;
        margin-bottom: 15px;
      }
      .empty-cart p {
        font-size: 18px;
        color: #718096;
        margin-bottom: 30px;
      }
      .shop-now-btn {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px 35px;
        border-radius: 25px;
        text-decoration: none;
        font-size: 18px;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
      }
      .shop-now-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
      }
      @media (max-width: 768px) {
        .profile-card {
          flex-direction: column;
          text-align: center;
        }
        .cart-section {
          padding: 20px;
        }
        .cart-title {
          font-size: 24px;
        }
        .summary-card {
          min-width: 100%;
        }
        .product-image {
          width: 60px;
          height: 60px;
        }
        .cart-table {
          font-size: 14px;
        }
        .cart-table th, .cart-table td {
          padding: 12px 8px;
        }
      }
  body
    .container
      //- User Profile Section
      .user-profile
        .profile-card
          img.profile-image(src=user.photo || '/images/default-avatar.png' alt="User Photo")
          .profile-info
            h2.user-name= user.name
            p.user-email= user.email
            span.cart-badge
              i.fas.fa-shopping-cart
              |  #{cart.totalProducts} items

      //- Main Cart Section
      .cart-section
        h1.cart-title
          i.fas.fa-shopping-bag
          |  Your Shopping Cart

        if cart && cart.products && cart.products.length > 0
          //- Cart Items Table
          .table-container
            table.cart-table
              thead
                tr
                  th Image
                  th Product Name
                  th Unit Price
                  th Quantity
                  th Subtotal
                  th Actions
              tbody
                each product in cart.products
                  tr(data-product-id=product.productId)
                    td
                      img.product-image(src=product.image alt=product.title)
                    td.product-title= product.title
                    td.product-price $#{product.price.toFixed(2)}
                    td.quantity-cell
                      .quantity-controls
                        button.qty-btn.decrease-btn(data-product-id=product.productId)
                          i.fas.fa-minus
                        span.quantity-display= product.quantity
                        button.qty-btn.increase-btn(data-product-id=product.productId)
                          i.fas.fa-plus
                    td.subtotal $#{(product.price * product.quantity).toFixed(2)}
                    td.action-cell
                      button.delete-btn(data-product-id=product.productId title="Remove from cart")
                        i.fas.fa-trash-alt

          //- Grand Total Section
          .grand-total-container
            .summary-card
              h3.summary-title
                i.fas.fa-receipt
                |  Order Summary
              .summary-row
                span.summary-label Total Items:
                span.summary-value #{cart.totalProducts}
              .summary-row
                span.summary-label Subtotal:
                span.summary-value $#{cart.totalCartPrice.toFixed(2)}
              .summary-row
                span.summary-label Shipping:
                span.summary-value Free
              .summary-row
                span.summary-label Tax (10%):
                span.summary-value $#{(cart.totalCartPrice * 0.10).toFixed(2)}
              hr.divider
              .summary-row.total-row
                span.summary-label Grand Total:
                span.summary-value.grand-total $#{(cart.totalCartPrice * 1.10).toFixed(2)}
              
              .action-buttons
                a.checkout-btn(href="/payments")
                  i.fas.fa-credit-card
                  |  Proceed to Checkout
                button.continue-shopping-btn(onclick="window.location.href='/payments'")
                  i.fas.fa-arrow-left
                  |  Continue Shopping
                button.clear-cart-btn
                  i.fas.fa-broom
                  |  Clear Cart

        else
          .empty-cart
            i.fas.fa-shopping-cart.empty-icon
            h2 Your cart is empty
            p Start adding some products to your cart!
            a.shop-now-btn(href="/products")
              i.fas.fa-shopping-bag
              |  Shop Now

    script.
      document.addEventListener('DOMContentLoaded', function() {
        const increaseBtns = document.querySelectorAll('.increase-btn');
        increaseBtns.forEach(btn => {
          btn.addEventListener('click', async function() {
            const productId = this.getAttribute('data-product-id');
            await updateQuantity(productId, 'increase');
          });
        });
        const decreaseBtns = document.querySelectorAll('.decrease-btn');
        decreaseBtns.forEach(btn => {
          btn.addEventListener('click', async function() {
            const productId = this.getAttribute('data-product-id');
            await updateQuantity(productId, 'decrease');
          });
        });
        const deleteBtns = document.querySelectorAll('.delete-btn');
        deleteBtns.forEach(btn => {
          btn.addEventListener('click', async function() {
            const productId = this.getAttribute('data-product-id');
            if (confirm('Are you sure you want to remove this item from your cart?')) {
              await deleteProduct(productId);
            }
          });
        });
        const clearCartBtn = document.querySelector('.clear-cart-btn');
        if (clearCartBtn) {
          clearCartBtn.addEventListener('click', async function() {
            if (confirm('Are you sure you want to clear your entire cart?')) {
              await clearCart();
            }
          });
        }
        async function updateQuantity(productId, action) {
          try {
            const response = await fetch(`/api/cart/${action}/${productId}`, {
              method: 'PATCH',
              headers: { 'Content-Type': 'application/json' }
            });
            const data = await response.json();
            if (response.ok) {
              location.reload();
            } else {
              alert(data.Message || 'Failed to update quantity');
            }
          } catch (error) {
            console.error('Error:', error);
            alert('An error occurred while updating the cart');
          }
        }
        async function deleteProduct(productId) {
          try {
            const response = await fetch(`/api/cart/${productId}`, {
              method: 'DELETE',
              headers: { 'Content-Type': 'application/json' }
            });
            const data = await response.json();
            if (response.ok) {
              location.reload();
            } else {
              alert(data.Message || 'Failed to delete product');
            }
          } catch (error) {
            console.error('Error:', error);
            alert('An error occurred while deleting the product');
          }
        }
        async function clearCart() {
          try {
            const response = await fetch('/api/cart/clear/all', {
              method: 'DELETE',
              headers: { 'Content-Type': 'application/json' }
            });
            const data = await response.json();
            if (response.ok) {
              location.reload();
            } else {
              alert(data.Message || 'Failed to clear cart');
            }
          } catch (error) {
            console.error('Error:', error);
            alert('An error occurred while clearing the cart');
          }
        }
      });